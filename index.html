<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extracteur de Citations Spirituelles (avec IA)</title>
    <style>
        :root {
            --primary: #764ba2;
            --secondary: #667eea;
            --accent: #ff9a9e;
            --bg-glass: rgba(255, 255, 255, 0.9);
            --text-main: #2d3436;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 40px 20px;
            color: var(--text-main);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--bg-glass);
            backdrop-filter: blur(15px);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 40px;
            font-size: 3em;
            font-weight: 800;
            background: linear-gradient(to right, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .upload-section {
            background: rgba(102, 126, 234, 0.05);
            border: 3px dashed var(--secondary);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            margin-bottom: 40px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .upload-section:hover {
            border-color: var(--primary);
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-5px);
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 45px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 10px 20px rgba(118, 75, 162, 0.3);
            transition: all 0.3s;
        }

        .file-label:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(118, 75, 162, 0.4);
        }

        .file-name {
            margin-top: 15px;
            color: #666;
            font-style: italic;
        }

        .options-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .option-group {
            margin-bottom: 0;
        }

        .option-group.full-width {
            grid-column: span 2;
        }

        .option-group label {
            display: block;
            margin-bottom: 12px;
            color: #555;
            font-weight: 600;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="number"] {
            padding: 15px 25px;
            border: 2px solid #eee;
            border-radius: 15px;
            width: 100%;
            font-size: 1em;
            transition: all 0.3s;
            outline: none;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #f0f4f8;
            padding: 15px 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .checkbox-container:hover {
            background: #e2e8f0;
        }

        input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 60px;
            border-radius: 50px;
            font-size: 1.25em;
            font-weight: 700;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            box-shadow: 0 10px 25px rgba(118, 75, 162, 0.3);
            transition: all 0.3s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(118, 75, 162, 0.4);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .citations-container {
            margin-top: 40px;
        }

        .citation {
            background: white;
            border-left: 8px solid var(--primary);
            padding: 35px;
            margin-bottom: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
            animation: fadeIn 0.5s ease-in;
        }

        .citation:hover {
            transform: scale(1.02);
        }

        .citation::before {
            content: 'â€œ';
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 5em;
            color: rgba(118, 75, 162, 0.05);
            font-family: serif;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .citation-text {
            font-size: 1.3em;
            line-height: 1.7;
            color: #2d3436;
            margin-bottom: 20px;
            font-style: italic;
            position: relative;
            z-index: 1;
        }

        .citation-context {
            font-size: 0.9em;
            color: #888;
            border-top: 1px solid #f0f0f0;
            padding-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.6;
            }
        }

        .error {
            background: #fff5f5;
            color: #d63031;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #fab1a0;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
        }

        .info {
            background: #edf2ff;
            color: #4c6ef5;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
        }

        .ai-badge {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-indicator {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }

        @media (max-width: 600px) {
            .options-section {
                grid-template-columns: 1fr;
            }

            .option-group.full-width {
                grid-column: span 1;
            }

            .container {
                padding: 25px;
            }

            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ðŸ“– Extracteur de Citations Spirituelles</h1>

        <div class="upload-section">
            <label for="fileInput" class="file-label">
                SÃ©lectionner un fichier (PDF ou TXT)
            </label>
            <input type="file" id="fileInput" accept=".pdf,.txt,.epub">
            <div class="file-name" id="fileName">Aucun fichier sÃ©lectionnÃ©</div>
        </div>

        <div class="options-section">
            <div class="option-group full-width">
                <label for="keywordInput">ThÃ¨me ou mot-clÃ© pour chercher un paradoxe (optionnel) :</label>
                <input type="text" id="keywordInput" placeholder="Ex: lumiÃ¨re, foi, silence, mort...">
            </div>

            <div class="option-group">
                <label for="numCitations">QuantitÃ© de citations :</label>
                <input type="number" id="numCitations" value="5" min="1" max="20">
            </div>

            <div class="option-group">
                <label>&nbsp;</label>
                <label for="useAI" class="checkbox-container">
                    <input type="checkbox" id="useAI" checked>
                    <span>Utiliser l'IA <span class="ai-badge">Premium</span></span>
                </label>
            </div>
        </div>

        <button id="extractBtn" disabled>Extraire Citations</button>

        <div id="messageContainer"></div>
        <div id="citationsContainer" class="citations-container"></div>
    </div>

    <!-- PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        // Configuration PDF.js
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;
        }

        // Configuration du proxy HuggingFace
        const PROXY_URL = "https://gildasr-dictionnaires.hf.space/api/chat";

        // ModÃ¨les OpenRouter : SÃ©lection des modÃ¨les gratuits les plus puissants (Llama 70B/405B, etc.)
        const OPENROUTER_MODELS = [
            "meta-llama/llama-3.3-70b-instruct:free",
            "meta-llama/llama-3.1-405b-instruct:free",
            "mistralai/mistral-small-3.1-24b-instruct:free",
            "google/gemini-2.0-pro-exp-02-05:free",
            "openai/gpt-oss-120b:free",
            "tngtech/deepseek-r1t-chimera:free",
            "anthropic/claude-3-haiku"
        ];

        const DELAY_BETWEEN_MODELS = 3000;  // 3 secondes
        const DELAY_AFTER_ERROR = 5000;     // 5 secondes
        const API_TIMEOUT = 60000;          // 60 secondes
        const MAX_ATTEMPTS_PER_BOOK = 12;

        // Vocabulaire religieux pour dÃ©tection
        const vocabulaireReligieux = [
    // Noms divins et figures sacrÃ©es
    'dieu', 'seigneur', 'christ', 'jÃ©sus', 'esprit', 'saint', 'trinitÃ©',
    'allah', 'prophÃ¨te', 'muhammad', 'mahomet', 'marie', 'vierge',
    
    // Concepts thÃ©ologiques fondamentaux
    'divin', 'sacrÃ©', 'Ã©ternel', 'transcendance', 'immanence', 'providence',
    'grÃ¢ce', 'misÃ©ricorde', 'rÃ©demption', 'salut', 'incarnation', 'rÃ©surrection',
    
    // Dimension intÃ©rieure et mystique
    'Ã¢me', 'esprit', 'cÅ“ur', 'conscience', 'intÃ©rioritÃ©', 'mystique',
    'contempl', 'mÃ©ditation', 'oraison', 'recueillement', 'silence',
    'illumination', 'rÃ©vÃ©lation', 'extase', 'union', 'thÃ©osis', 'dÃ©ification',
    
    // Vertus et Ã©tats spirituels
    'foi', 'espÃ©rance', 'charitÃ©', 'amour', 'humilitÃ©', 'obÃ©issance',
    'pauvretÃ©', 'dÃ©tachement', 'abandon', 'confiance', 'patience',
    'sagesse', 'discernement', 'puretÃ©', 'simplicitÃ©',
    
    // Pratiques et voies
    'priÃ¨re', 'jeÃ»ne', 'ascÃ¨se', 'pÃ©nitence', 'pardon', 'confession',
    'communion', 'eucharistie', 'sacrement', 'baptÃªme',
    'ramadan', 'hajj', 'pÃ¨lerinage', 'dhikr', 'soufisme',
    
    // Chute et rÃ©demption
    'pÃ©chÃ©', 'chute', 'tentation', 'Ã©preuve', 'purification', 'conversion',
    'repentir', 'pÃ©nitent', 'rachat', 'expiation',
    
    // RÃ©alitÃ©s eschatologiques
    'paradis', 'ciel', 'enfer', 'purgatoire', 'jugement', 'Ã©ternitÃ©',
    'royaume', 'vie Ã©ternelle', 'rÃ©surrection', 'gloire',
    
    // Textes et traditions
    'Ã©vangile', 'Ã©criture', 'parole', 'testament', 'bible',
    'coran', 'sourate', 'verset', 'hadith', 'sunna', 'tradition',
    
    // Lieux et communautÃ©s
    'Ã©glise', 'temple', 'cathÃ©drale', 'monastÃ¨re', 'ermitage',
    'mosquÃ©e', 'mecque', 'mÃ©dine', 'jÃ©rusalem',
    'communautÃ©', 'fidÃ¨le', 'croyant', 'disciple', 'frÃ¨re', 'sÅ“ur',
    
    // Symboles et rituels
    'croix', 'crucifixion', 'passion', 'sang', 'pain', 'vin',
    'lumiÃ¨re', 'tÃ©nÃ¨bres', 'eau', 'feu', 'souffle', 'voile',
    'rosaire', 'chapelet', 'icÃ´ne', 'relique',
    
    // Paradoxes mystiques classiques
    'mort', 'vie', 'vide', 'plein', 'nuit', 'jour',
    'anÃ©antissement', 'Ãªtre', 'nÃ©ant', 'tout', 'rien',
    'pauvre', 'riche', 'petit', 'grand', 'dernier', 'premier',
    'serviteur', 'maÃ®tre', 'esclave', 'libre',
    
    // Voie mystique
    'nuit obscure', 'dÃ©sert', 'ariditÃ©', 'consolation', 'dÃ©solation',
    'quiÃ©tude', 'passivitÃ©', 'activitÃ©', 'effort', 'don',
    'volontÃ©', 'abandon', 'renoncement', 'possession',
    
    // Termes soufis et mystiques musulmans
    'fana', 'baqa', 'tawhid', 'nafs', 'qalb', 'ruh',
    'maqam', 'hal', 'tariqa', 'soufi', 'derviche',
    
    // Termes mystiques chrÃ©tiens
    'thÃ©ologie nÃ©gative', 'apophatique', 'nuÃ©e', 'tÃ©nÃ¨bre divine',
    'hÃ©sychasme', 'quiÃ©tisme', 'abandon', 'petite voie',
    
    // ExpÃ©rience spirituelle
    'consolation', 'sÃ©cheresse', 'ariditÃ©', 'ferveur',
    'vision', 'locution', 'stigmate', 'miracle', 'grÃ¢ce',
    'onction', 'prÃ©sence', 'absence', 'proximitÃ©', 'distance'
];

        let fileContent = '';
        let selectedFile = null;
        let pageIndex = [];
        let currentModelIndex = 0;

        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        const extractBtn = document.getElementById('extractBtn');
        const citationsContainer = document.getElementById('citationsContainer');
        const messageContainer = document.getElementById('messageContainer');
        const keywordInput = document.getElementById('keywordInput');
        const numCitationsInput = document.getElementById('numCitations');
        const useAICheckbox = document.getElementById('useAI');

        fileInput.addEventListener('change', async (e) => {
            selectedFile = e.target.files[0];
            if (selectedFile) {
                fileName.textContent = selectedFile.name;
                extractBtn.disabled = false;
                citationsContainer.innerHTML = '';
                messageContainer.innerHTML = '';
            }
        });

        extractBtn.addEventListener('click', async () => {
            if (!selectedFile) return;

            showMessage('Lecture du fichier...', 'loading');
            extractBtn.disabled = true;

            try {
                pageIndex = [];

                if (selectedFile.name.toLowerCase().endsWith('.pdf')) {
                    fileContent = await extractTextFromPDF(selectedFile);
                } else if (selectedFile.name.toLowerCase().endsWith('.txt')) {
                    fileContent = await extractTextFromTXT(selectedFile);
                } else if (selectedFile.name.toLowerCase().endsWith('.epub')) {
                    fileContent = await extractTextFromEPUB(selectedFile);
                }

                if (!fileContent || fileContent.trim().length === 0) {
                    showMessage('Le fichier semble vide ou n\'a pas pu Ãªtre lu.', 'error');
                    extractBtn.disabled = false;
                    return;
                }

                const keyword = keywordInput.value.trim();
                const numCitations = parseInt(numCitationsInput.value) || 5;
                const useAI = useAICheckbox.checked;

                let citations;
                if (useAI) {
                    citations = await extractCitationsWithAI(fileContent, keyword, numCitations);
                } else {
                    citations = extractCitations(fileContent, keyword, numCitations);
                }

                displayCitations(citations, useAI);
                extractBtn.disabled = false;

            } catch (error) {
                showMessage('Erreur lors du traitement: ' + error.message, 'error');
                extractBtn.disabled = false;
            }
        });

        async function extractTextFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';
            let charCount = 0;

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ') + '\n';

                pageIndex.push({
                    pageNumber: i,
                    startChar: charCount,
                    endChar: charCount + pageText.length
                });

                fullText += pageText;
                charCount += pageText.length;
            }

            return fullText;
        }

        async function extractTextFromTXT(file) {
            return await file.text();
        }

        async function extractTextFromEPUB(file) {
            const arrayBuffer = await file.arrayBuffer();
            const zip = await JSZip.loadAsync(arrayBuffer);
            let fullText = '';

            for (let filename in zip.files) {
                if (filename.match(/\.(html|xhtml|htm)$/i)) {
                    const content = await zip.files[filename].async('string');
                    const textOnly = content.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ');
                    fullText += textOnly + '\n';
                }
            }

            return fullText;
        }

        function extractCitations(text, keyword = '', numCitations = 5) {
            const phraseRegex = /[^.!?]+[.!?]+/g;
            let match;
            const phrasesAvecPosition = [];

            while ((match = phraseRegex.exec(text)) !== null) {
                const phrase = match[0].trim();
                if (phrase.length > 50 && phrase.length < 500) {
                    phrasesAvecPosition.push({
                        phrase: phrase,
                        position: match.index
                    });
                }
            }

            let phrasesReligieuses = phrasesAvecPosition.filter(item => {
                const phraseLower = item.phrase.toLowerCase();
                return vocabulaireReligieux.some(mot => phraseLower.includes(mot));
            });

            if (keyword && keyword.length > 0) {
                const keywordLower = keyword.toLowerCase();
                const antonymes = getAntonyms(keywordLower);

                // On privilÃ©gie les phrases avec le keyword
                let keywordCandidates = phrasesReligieuses.filter(item => {
                    const phraseLower = item.phrase.toLowerCase();
                    return phraseLower.includes(keywordLower);
                });

                // Si on a des candidats avec le keyword, on cherche s'ils ont aussi un antonyme (paradoxe fort)
                if (keywordCandidates.length > 0) {
                    const paradoxCandidates = keywordCandidates.filter(item => {
                        const phraseLower = item.phrase.toLowerCase();
                        return antonymes.some(ant => phraseLower.includes(ant));
                    });

                    // Si on a des paradoxes explicites, on les utilise en prioritÃ©
                    if (paradoxCandidates.length > 0) {
                        phrasesReligieuses = paradoxCandidates;
                    } else {
                        // Sinon on garde les phrases avec le keyword, l'IA fera le tri
                        phrasesReligieuses = keywordCandidates;
                    }
                } else if (phrasesReligieuses.length > numCitations * 3) {
                    // Si on n'a rien avec le keyword mais beaucoup de religieux,
                    // on garde tout et on laisse le scoring paradoxal naturel agir
                }
            }

            if (phrasesReligieuses.length === 0) {
                showMessage('Aucune citation avec vocabulaire religieux trouvÃ©e.', 'info');
                return [];
            }

            const phrasesAvecScore = phrasesReligieuses.map(item => {
                const score = calculateParadoxScore(item.phrase, keyword);
                return {
                    phrase: item.phrase,
                    score: score,
                    position: item.position
                };
            });

            phrasesAvecScore.sort((a, b) => b.score - a.score);
            return phrasesAvecScore.slice(0, numCitations);
        }

        function calculateParadoxScore(phrase, keyword = '') {
            const phraseLower = phrase.toLowerCase();
            let score = 0;

            const motsParadoxaux = [
    // LumiÃ¨re et obscuritÃ©
    ['lumiÃ¨re', 'tÃ©nÃ¨bres'], ['lumiÃ¨re', 'obscuritÃ©'], ['lumiÃ¨re', 'nuit'],
    ['jour', 'nuit'], ['clartÃ©', 'obscuritÃ©'], ['illumination', 'aveuglement'],
    ['voir', 'aveugle'], ['rÃ©vÃ©lation', 'voile'], ['dÃ©voiler', 'cacher'],
    
    // Vie et mort
    ['vie', 'mort'], ['vivre', 'mourir'], ['vivant', 'mort'],
    ['naÃ®tre', 'mourir'], ['rÃ©surrection', 'mort'], ['renaissance', 'mort'],
    ['mortel', 'immortel'], ['pÃ©rissable', 'impÃ©rissable'],
    
    // ÃŠtre et nÃ©ant
    ['Ãªtre', 'nÃ©ant'], ['Ãªtre', 'non-Ãªtre'], ['existence', 'nÃ©ant'],
    ['tout', 'rien'], ['plÃ©nitude', 'vide'], ['plein', 'vide'],
    ['prÃ©sence', 'absence'], ['exister', 'anÃ©antir'],
    
    // Connaissance et ignorance
    ['savoir', 'ignorer'], ['connaissance', 'ignorance'], ['sagesse', 'folie'],
    ['connu', 'inconnu'], ['comprendre', 'incomprÃ©hensible'], ['certain', 'incertain'],
    ['science', 'ignorance'], ['rÃ©vÃ©ler', 'cacher'], ['manifeste', 'cachÃ©'],
    ['visible', 'invisible'], ['apparaÃ®tre', 'disparaÃ®tre'], ['montrer', 'voiler'],
    
    // Foi et doute
    ['foi', 'doute'], ['croire', 'douter'], ['certitude', 'incertitude'],
    ['confiance', 'mÃ©fiance'], ['espoir', 'dÃ©sespoir'], ['espÃ©rance', 'dÃ©sespÃ©rance'],
    
    // Amour et haine
    ['amour', 'haine'], ['aimer', 'haÃ¯r'], ['charitÃ©', 'Ã©goÃ¯sme'],
    ['dilection', 'aversion'], ['attraction', 'rÃ©pulsion'],
    
    // Bien et mal
    ['bien', 'mal'], ['bon', 'mauvais'], ['vertu', 'vice'],
    ['juste', 'injuste'], ['justice', 'injustice'], ['saintetÃ©', 'pÃ©chÃ©'],
    ['pur', 'impur'], ['puretÃ©', 'impuretÃ©'], ['innocent', 'coupable'],
    
    // Paix et guerre
    ['paix', 'guerre'], ['repos', 'combat'], ['calme', 'tempÃªte'],
    ['tranquillitÃ©', 'trouble'], ['quiÃ©tude', 'agitation'], ['sÃ©rÃ©nitÃ©', 'tourment'],
    
    // Grandeur et petitesse
    ['grand', 'petit'], ['grandeur', 'petitesse'], ['immense', 'infime'],
    ['Ã©levÃ©', 'bas'], ['haut', 'bas'], ['sublime', 'humble'],
    ['majestÃ©', 'humilitÃ©'], ['gloire', 'abaissement'],
    
    // Richesse et pauvretÃ© (paradoxe Ã©vangÃ©lique central)
    ['riche', 'pauvre'], ['richesse', 'pauvretÃ©'], ['possÃ©der', 'dÃ©pouiller'],
    ['avoir', 'manquer'], ['abondance', 'dÃ©nuement'], ['plein', 'vide'],
    ['donner', 'recevoir'], ['perdre', 'gagner'], ['abandonner', 'garder'],
    
    // Force et faiblesse
    ['fort', 'faible'], ['force', 'faiblesse'], ['puissance', 'impuissance'],
    ['pouvoir', 'impuissance'], ['capable', 'incapable'], ['victorieux', 'vaincu'],
    
    // LibertÃ© et servitude
    ['libre', 'esclave'], ['libertÃ©', 'servitude'], ['libÃ©rer', 'enchaÃ®ner'],
    ['dÃ©livrer', 'captif'], ['autonomie', 'dÃ©pendance'], ['indÃ©pendant', 'dÃ©pendant'],
    
    // Premier et dernier (paradoxe Ã©vangÃ©lique)
    ['premier', 'dernier'], ['commencer', 'finir'], ['dÃ©but', 'fin'],
    ['origine', 'terme'], ['alpha', 'omÃ©ga'], ['principe', 'fin'],
    
    // MaÃ®tre et serviteur
    ['maÃ®tre', 'serviteur'], ['maÃ®tre', 'esclave'], ['seigneur', 'serviteur'],
    ['commander', 'obÃ©ir'], ['dominer', 'servir'], ['roi', 'esclave'],
    
    // IntÃ©rieur et extÃ©rieur
    ['dedans', 'dehors'], ['intÃ©rieur', 'extÃ©rieur'], ['intime', 'lointain'],
    ['proche', 'lointain'], ['proximitÃ©', 'distance'], ['cachÃ©', 'manifeste'],
    
    // UnitÃ© et multiplicitÃ©
    ['un', 'multiple'], ['unitÃ©', 'multiplicitÃ©'], ['unique', 'divers'],
    ['simple', 'composÃ©'], ['simplicitÃ©', 'complexitÃ©'], ['indivisible', 'divisible'],
    
    // Parole et silence
    ['parole', 'silence'], ['parler', 'taire'], ['dire', 'silence'],
    ['verbe', 'silence'], ['exprimer', 'taire'], ['proclamer', 'cacher'],
    
    // ActivitÃ© et passivitÃ© (mystique)
    ['agir', 'subir'], ['actif', 'passif'], ['action', 'passion'],
    ['faire', 'laisser'], ['effort', 'abandon'], ['volontÃ©', 'abandon'],
    ['travailler', 'reposer'], ['Å“uvre', 'grÃ¢ce'], ['mÃ©rite', 'don'],
    
    // Mouvement et repos
    ['mouvement', 'repos'], ['mobile', 'immobile'], ['marcher', 'demeurer'],
    ['aller', 'rester'], ['avancer', 'arrÃªter'], ['chercher', 'trouver'],
    ['errer', 'habiter'], ['exil', 'demeure'], ['voyage', 'sÃ©jour'],
    
    // Temps et Ã©ternitÃ©
    ['temps', 'Ã©ternitÃ©'], ['temporel', 'Ã©ternel'], ['Ã©phÃ©mÃ¨re', 'Ã©ternel'],
    ['passager', 'permanent'], ['transitoire', 'immuable'], ['changeant', 'immuable'],
    ['mortel', 'immortel'], ['corruptible', 'incorruptible'],
    
    // Terre et ciel
    ['terre', 'ciel'], ['terrestre', 'cÃ©leste'], ['bas', 'haut'],
    ['matÃ©riel', 'spirituel'], ['corporel', 'spirituel'], ['chair', 'esprit'],
    ['charnel', 'spirituel'], ['monde', 'ciel'], ['sÃ©culier', 'sacrÃ©'],
    
    // SacrÃ© et profane
    ['sacrÃ©', 'profane'], ['saint', 'profane'], ['divin', 'humain'],
    ['surnaturel', 'naturel'], ['grÃ¢ce', 'nature'], ['transcendant', 'immanent'],
    
    // Soi et autre (mystique de l'union)
    ['soi', 'autre'], ['je', 'tu'], ['moi', 'toi'],
    ['propre', 'Ã©tranger'], ['mÃªme', 'autre'], ['identitÃ©', 'altÃ©ritÃ©'],
    
    // VÃ©ritÃ© et erreur
    ['vrai', 'faux'], ['vÃ©ritÃ©', 'erreur'], ['vÃ©ritÃ©', 'mensonge'],
    ['authentique', 'illusoire'], ['rÃ©el', 'apparent'], ['Ãªtre', 'paraÃ®tre'],
    
    // Joie et tristesse
    ['joie', 'tristesse'], ['joie', 'douleur'], ['consolation', 'dÃ©solation'],
    ['allÃ©gresse', 'affliction'], ['bonheur', 'malheur'], ['bÃ©atitude', 'souffrance'],
    
    // Souffrance et gloire (kÃ©nose/passion)
    ['souffrance', 'gloire'], ['croix', 'gloire'], ['humiliation', 'exaltation'],
    ['abaissement', 'Ã©lÃ©vation'], ['passion', 'rÃ©surrection'], ['mort', 'rÃ©surrection'],
    
    // PlÃ©nitude et vide (mystique apophatique)
    ['plÃ©nitude', 'dÃ©pouillement'], ['tout', 'nÃ©ant'], ['possÃ©der', 'renoncer'],
    ['avoir', 'Ãªtre'], ['accumulation', 'dÃ©pouillement'], ['saisir', 'lÃ¢cher'],
    
    // DÃ©sir et dÃ©tachement
    ['dÃ©sir', 'dÃ©tachement'], ['vouloir', 'renoncer'], ['convoiter', 'abandonner'],
    ['attacher', 'dÃ©tacher'], ['tenir', 'lÃ¢cher'], ['garder', 'donner'],
    
    // Parler et taire (mystique apophatique)
    ['affirmer', 'nier'], ['dire', 'indicible'], ['nommer', 'innommable'],
    ['exprimer', 'inexprimable'], ['comprendre', 'incomprÃ©hensible'],
    
    // Repos et effort
    ['repos', 'effort'], ['reposer', 'travailler'], ['sommeil', 'veille'],
    ['contempler', 'agir'], ['quiÃ©tude', 'ascÃ¨se'], ['passivitÃ©', 'action'],
    
    // Nourrir et jeÃ»ner
    ['nourrir', 'jeÃ»ner'], ['manger', 'jeÃ»ner'], ['festin', 'jeÃ»ne'],
    ['satiÃ©tÃ©', 'faim'], ['rassasier', 'affamer'], ['abondance', 'abstinence'],
    
    // Ouverture et fermeture
    ['ouvrir', 'fermer'], ['ouvert', 'fermÃ©'], ['accueillir', 'refuser'],
    ['recevoir', 'rejeter'], ['porte ouverte', 'porte fermÃ©e'],
    
    // Sommeil et Ã©veil (spirituel)
    ['Ã©veil', 'sommeil'], ['Ã©veillÃ©', 'endormi'], ['veille', 'sommeil'],
    ['vigilance', 'torpeur'], ['lucide', 'aveugle'],
    
    // Monter et descendre (kÃ©nose/ascension)
    ['monter', 'descendre'], ['ascension', 'descente'], ['Ã©lever', 'abaisser'],
    ['grimper', 'tomber'], ['lever', 'baisser'],
    
    // Rassembler et disperser
    ['rassembler', 'disperser'], ['unir', 'sÃ©parer'], ['joindre', 'diviser'],
    ['rÃ©unir', 'Ã©parpiller'], ['concentrer', 'dissiper'],
    
    // Remplir et vider (kÃ©nose)
    ['remplir', 'vider'], ['combler', 'creuser'], ['garnir', 'dÃ©pouiller'],
    ['emplir', 'vider'], ['saturer', 'Ã©puiser'],
    
    // Construire et dÃ©truire
    ['construire', 'dÃ©truire'], ['Ã©difier', 'dÃ©molir'], ['bÃ¢tir', 'ruiner'],
    ['crÃ©er', 'anÃ©antir'], ['fonder', 'renverser'],
    
    // Lier et dÃ©lier (pouvoir des clÃ©s)
    ['lier', 'dÃ©lier'], ['attacher', 'dÃ©tacher'], ['enchaÃ®ner', 'libÃ©rer'],
    ['nouer', 'dÃ©nouer'], ['retenir', 'relÃ¢cher'],
    
    // Montrer et cacher (mystÃ¨re)
    ['rÃ©vÃ©ler', 'cacher'], ['dÃ©voiler', 'voiler'], ['montrer', 'dissimuler'],
    ['manifester', 'mystÃ¨re'], ['apparent', 'secret'], ['public', 'secret'],
    
    // Nouveau et ancien
    ['nouveau', 'ancien'], ['neuf', 'vieux'], ['recommencer', 'finir'],
    ['renaissance', 'vieillesse'], ['innovation', 'tradition']
];

            motsParadoxaux.forEach(paire => {
                if (phraseLower.includes(paire[0]) && phraseLower.includes(paire[1])) {
                    score += 10;
                }
            });

            if (keyword && phraseLower.includes(keyword.toLowerCase())) {
                score += 15;
            }

            const indicateursParadoxe = ['mais', 'pourtant', 'cependant', 'toutefois',
                'nÃ©anmoins', 'malgrÃ©', 'bien que', 'quoique'];
            indicateursParadoxe.forEach(mot => {
                if (phraseLower.includes(mot)) score += 5;
            });

            if (phrase.length > 100 && phrase.length < 300) score += 2;

            return score;
        }

        function getAntonyms(keyword) {
            const antonymesMap = {
    // LumiÃ¨re et obscuritÃ©
    'lumiÃ¨re': ['tÃ©nÃ¨bres', 'obscuritÃ©', 'ombre', 'nuit', 'noirceur', 'opacitÃ©'],
    'tÃ©nÃ¨bres': ['lumiÃ¨re', 'clartÃ©', 'jour', 'luminositÃ©', 'Ã©clat'],
    'obscuritÃ©': ['lumiÃ¨re', 'clartÃ©', 'luminositÃ©', 'transparence'],
    'jour': ['nuit', 'tÃ©nÃ¨bres', 'obscuritÃ©'],
    'nuit': ['jour', 'lumiÃ¨re', 'aube', 'aurore'],
    'clartÃ©': ['obscuritÃ©', 'tÃ©nÃ¨bres', 'opacitÃ©'],
    'illumination': ['aveuglement', 'obscuritÃ©', 'ignorance'],
    'aveugle': ['voyant', 'clairvoyant', 'lucide'],
    'voir': ['aveugler', 'ignorer', 'mÃ©connaÃ®tre'],
    
    // Vie et mort
    'vie': ['mort', 'trÃ©pas', 'dÃ©cÃ¨s', 'agonie', 'fin'],
    'mort': ['vie', 'naissance', 'renaissance', 'rÃ©surrection'],
    'vivre': ['mourir', 'pÃ©rir', 'expirer', 'trÃ©passer'],
    'mourir': ['vivre', 'naÃ®tre', 'renaÃ®tre', 'ressusciter'],
    'vivant': ['mort', 'dÃ©funt', 'inanimÃ©', 'cadavre'],
    'naÃ®tre': ['mourir', 'disparaÃ®tre', 'finir'],
    'naissance': ['mort', 'fin', 'terme', 'dÃ©cÃ¨s'],
    'rÃ©surrection': ['mort', 'ensevelissement', 'tombeau'],
    'mortel': ['immortel', 'Ã©ternel', 'impÃ©rissable'],
    'immortel': ['mortel', 'pÃ©rissable', 'Ã©phÃ©mÃ¨re'],
    'pÃ©rissable': ['impÃ©rissable', 'Ã©ternel', 'immortel'],
    
    // ÃŠtre et nÃ©ant
    'Ãªtre': ['nÃ©ant', 'non-Ãªtre', 'rien', 'vide'],
    'nÃ©ant': ['Ãªtre', 'existence', 'tout', 'plÃ©nitude'],
    'existence': ['nÃ©ant', 'non-existence', 'absence'],
    'exister': ['nÃ©ant', 'anÃ©antir', 'disparaÃ®tre'],
    'tout': ['rien', 'nÃ©ant', 'vide', 'absence'],
    'rien': ['tout', 'plÃ©nitude', 'Ãªtre', 'existence'],
    'plÃ©nitude': ['vide', 'vacuitÃ©', 'nÃ©ant', 'manque'],
    'plein': ['vide', 'creux', 'vacant', 'dÃ©pouillÃ©'],
    'vide': ['plein', 'rempli', 'comblÃ©', 'saturÃ©'],
    'prÃ©sence': ['absence', 'Ã©loignement', 'manque'],
    'absence': ['prÃ©sence', 'proximitÃ©', 'prÃ©sent'],
    'anÃ©antir': ['crÃ©er', 'Ãªtre', 'exister', 'subsister'],
    
    // Connaissance et ignorance
    'savoir': ['ignorer', 'mÃ©connaÃ®tre', 'ignorer'],
    'ignorer': ['savoir', 'connaÃ®tre', 'comprendre'],
    'connaissance': ['ignorance', 'mÃ©connaissance', 'aveuglement'],
    'ignorance': ['connaissance', 'savoir', 'science', 'sagesse'],
    'sagesse': ['folie', 'sottise', 'dÃ©raison', 'ignorance'],
    'folie': ['sagesse', 'raison', 'sens', 'prudence'],
    'sage': ['fou', 'insensÃ©', 'ignorant'],
    'fou': ['sage', 'sensÃ©', 'raisonnable'],
    'connu': ['inconnu', 'ignorÃ©', 'cachÃ©', 'mystÃ©rieux'],
    'inconnu': ['connu', 'familier', 'rÃ©vÃ©lÃ©', 'manifeste'],
    'comprendre': ['ignorer', 'mÃ©connaÃ®tre', 'incomprÃ©hensible'],
    'incomprÃ©hensible': ['comprÃ©hensible', 'clair', 'Ã©vident', 'intelligible'],
    'certain': ['incertain', 'douteux', 'hÃ©sitant'],
    'incertain': ['certain', 'sÃ»r', 'assurÃ©', 'Ã©vident'],
    'science': ['ignorance', 'mÃ©connaissance', 'aveuglement'],
    'rÃ©vÃ©ler': ['cacher', 'voiler', 'dissimuler', 'occulter'],
    'cacher': ['rÃ©vÃ©ler', 'montrer', 'dÃ©voiler', 'manifester'],
    'manifeste': ['cachÃ©', 'secret', 'occulte', 'mystÃ©rieux'],
    'cachÃ©': ['manifeste', 'visible', 'apparent', 'rÃ©vÃ©lÃ©'],
    'visible': ['invisible', 'cachÃ©', 'occulte', 'secret'],
    'invisible': ['visible', 'apparent', 'manifeste', 'Ã©vident'],
    'apparaÃ®tre': ['disparaÃ®tre', 'cacher', 'voiler'],
    'disparaÃ®tre': ['apparaÃ®tre', 'surgir', 'se montrer'],
    'montrer': ['cacher', 'voiler', 'dissimuler'],
    'voiler': ['dÃ©voiler', 'rÃ©vÃ©ler', 'montrer', 'dÃ©couvrir'],
    'dÃ©voiler': ['voiler', 'cacher', 'dissimuler', 'recouvrir'],
    'secret': ['public', 'manifeste', 'ouvert', 'rÃ©vÃ©lÃ©'],
    'mystÃ¨re': ['rÃ©vÃ©lation', 'Ã©vidence', 'clartÃ©'],
    
    // Foi et doute
    'foi': ['doute', 'incrÃ©dulitÃ©', 'incroyance', 'scepticisme'],
    'doute': ['foi', 'certitude', 'croyance', 'conviction'],
    'croire': ['douter', 'mÃ©croire', 'renier'],
    'douter': ['croire', 'avoir foi', 'Ãªtre certain'],
    'certitude': ['doute', 'incertitude', 'hÃ©sitation'],
    'confiance': ['mÃ©fiance', 'dÃ©fiance', 'suspicion', 'doute'],
    'mÃ©fiance': ['confiance', 'foi', 'assurance'],
    'espoir': ['dÃ©sespoir', 'dÃ©sespÃ©rance', 'dÃ©couragement'],
    'dÃ©sespoir': ['espoir', 'espÃ©rance', 'confiance'],
    'espÃ©rance': ['dÃ©sespÃ©rance', 'dÃ©sespoir', 'dÃ©couragement'],
    'croyant': ['incroyant', 'infidÃ¨le', 'mÃ©crÃ©ant', 'athÃ©e'],
    'fidÃ¨le': ['infidÃ¨le', 'renÃ©gat', 'apostat', 'traÃ®tre'],
    
    // Amour et haine
    'amour': ['haine', 'aversion', 'rÃ©pulsion', 'hostilitÃ©', 'indiffÃ©rence'],
    'haine': ['amour', 'charitÃ©', 'affection', 'tendresse'],
    'aimer': ['haÃ¯r', 'dÃ©tester', 'abhorrer', 'mÃ©priser'],
    'haÃ¯r': ['aimer', 'chÃ©rir', 'adorer'],
    'charitÃ©': ['Ã©goÃ¯sme', 'avarice', 'cupiditÃ©', 'haine'],
    'Ã©goÃ¯sme': ['charitÃ©', 'altruisme', 'gÃ©nÃ©rositÃ©', 'don'],
    'dilection': ['aversion', 'rÃ©pulsion', 'haine'],
    'aversion': ['dilection', 'attraction', 'amour'],
    'attraction': ['rÃ©pulsion', 'aversion', 'rejet'],
    'rÃ©pulsion': ['attraction', 'attrait', 'amour'],
    
    // Bien et mal
    'bien': ['mal', 'vice', 'pÃ©chÃ©', 'faute', 'crime'],
    'mal': ['bien', 'vertu', 'bontÃ©', 'justice'],
    'bon': ['mauvais', 'mÃ©chant', 'pervers', 'vicieux'],
    'mauvais': ['bon', 'bienfaisant', 'vertueux'],
    'vertu': ['vice', 'pÃ©chÃ©', 'dÃ©faut', 'mal'],
    'vice': ['vertu', 'qualitÃ©', 'bien', 'mÃ©rite'],
    'juste': ['injuste', 'inique', 'inÃ©quitable'],
    'injuste': ['juste', 'Ã©quitable', 'droit'],
    'justice': ['injustice', 'iniquitÃ©', 'inÃ©quitÃ©'],
    'injustice': ['justice', 'Ã©quitÃ©', 'droiture'],
    'saintetÃ©': ['pÃ©chÃ©', 'vice', 'corruption', 'impiÃ©tÃ©'],
    'saint': ['pÃ©cheur', 'impie', 'profane', 'damnÃ©'],
    'pÃ©chÃ©': ['saintetÃ©', 'grÃ¢ce', 'vertu', 'puretÃ©'],
    'pÃ©cheur': ['saint', 'juste', 'Ã©lu', 'bienheureux'],
    'pur': ['impur', 'souillÃ©', 'corrompu', 'contaminÃ©'],
    'impur': ['pur', 'innocent', 'immaculÃ©', 'saint'],
    'puretÃ©': ['impuretÃ©', 'souillure', 'corruption'],
    'impuretÃ©': ['puretÃ©', 'innocence', 'saintetÃ©'],
    'innocent': ['coupable', 'criminel', 'fautif'],
    'coupable': ['innocent', 'irrÃ©prochable', 'pur'],
    
    // Paix et guerre
    'paix': ['guerre', 'conflit', 'combat', 'lutte', 'hostilitÃ©'],
    'guerre': ['paix', 'harmonie', 'concorde', 'repos'],
    'repos': ['combat', 'lutte', 'effort', 'agitation'],
    'combat': ['repos', 'paix', 'trÃªve', 'calme'],
    'calme': ['tempÃªte', 'agitation', 'trouble', 'tumulte'],
    'tempÃªte': ['calme', 'sÃ©rÃ©nitÃ©', 'tranquillitÃ©', 'bonace'],
    'tranquillitÃ©': ['trouble', 'agitation', 'tumulte', 'tourment'],
    'trouble': ['tranquillitÃ©', 'calme', 'paix', 'sÃ©rÃ©nitÃ©'],
    'quiÃ©tude': ['agitation', 'trouble', 'inquiÃ©tude', 'tourment'],
    'agitation': ['quiÃ©tude', 'calme', 'repos', 'paix'],
    'sÃ©rÃ©nitÃ©': ['tourment', 'angoisse', 'trouble', 'agitation'],
    'tourment': ['sÃ©rÃ©nitÃ©', 'paix', 'repos', 'quiÃ©tude'],
    
    // Grandeur et petitesse
    'grand': ['petit', 'infime', 'minuscule', 'humble'],
    'petit': ['grand', 'immense', 'Ã©norme', 'Ã©levÃ©'],
    'grandeur': ['petitesse', 'humilitÃ©', 'bassesse', 'mesquinerie'],
    'petitesse': ['grandeur', 'majestÃ©', 'magnificence', 'Ã©lÃ©vation'],
    'immense': ['infime', 'minuscule', 'microscopique'],
    'infime': ['immense', 'Ã©norme', 'gigantesque', 'colossal'],
    'Ã©levÃ©': ['bas', 'infÃ©rieur', 'vil', 'abject'],
    'bas': ['Ã©levÃ©', 'haut', 'sublime', 'supÃ©rieur'],
    'haut': ['bas', 'infÃ©rieur', 'profond', 'abject'],
    'sublime': ['vil', 'bas', 'abject', 'humble'],
    'vil': ['sublime', 'noble', 'Ã©levÃ©', 'digne'],
    'majestÃ©': ['humilitÃ©', 'bassesse', 'petitesse'],
    'gloire': ['abaissement', 'humiliation', 'opprobre', 'honte'],
    'abaissement': ['gloire', 'Ã©lÃ©vation', 'exaltation', 'grandeur'],
    'Ã©lÃ©vation': ['abaissement', 'chute', 'dÃ©chÃ©ance'],
    'exaltation': ['humiliation', 'abaissement', 'avilissement'],
    'humiliation': ['exaltation', 'gloire', 'honneur', 'dignitÃ©'],
    
    // Richesse et pauvretÃ©
    'riche': ['pauvre', 'indigent', 'dÃ©muni', 'dÃ©pouillÃ©'],
    'pauvre': ['riche', 'opulent', 'fortunÃ©', 'nanti'],
    'richesse': ['pauvretÃ©', 'indigence', 'dÃ©nuement', 'misÃ¨re'],
    'pauvretÃ©': ['richesse', 'opulence', 'fortune', 'abondance'],
    'possÃ©der': ['dÃ©pouiller', 'manquer', 'perdre', 'renoncer'],
    'dÃ©pouiller': ['possÃ©der', 'avoir', 'garder', 'accumuler'],
    'avoir': ['manquer', 'perdre', 'Ãªtre privÃ©', 'renoncer'],
    'manquer': ['avoir', 'possÃ©der', 'abonder', 'regorger'],
    'abondance': ['dÃ©nuement', 'pÃ©nurie', 'manque', 'privation'],
    'dÃ©nuement': ['abondance', 'richesse', 'opulence', 'plÃ©nitude'],
    'donner': ['recevoir', 'prendre', 'garder', 'retenir'],
    'recevoir': ['donner', 'offrir', 'prodiguer'],
    'perdre': ['gagner', 'trouver', 'acquÃ©rir', 'obtenir'],
    'gagner': ['perdre', 'perdre', 'sacrifier', 'renoncer'],
    'abandonner': ['garder', 'retenir', 'conserver', 'possÃ©der'],
    'garder': ['abandonner', 'perdre', 'donner', 'lÃ¢cher'],
    
    // Force et faiblesse
    'fort': ['faible', 'dÃ©bile', 'impuissant', 'fragile'],
    'faible': ['fort', 'puissant', 'robuste', 'vigoureux'],
    'force': ['faiblesse', 'dÃ©bilitÃ©', 'impuissance', 'fragilitÃ©'],
    'faiblesse': ['force', 'puissance', 'vigueur', 'robustesse'],
    'puissance': ['impuissance', 'faiblesse', 'incapacitÃ©'],
    'impuissance': ['puissance', 'force', 'capacitÃ©', 'pouvoir'],
    'pouvoir': ['impuissance', 'incapacitÃ©', 'faiblesse'],
    'capable': ['incapable', 'impuissant', 'inapte'],
    'incapable': ['capable', 'apte', 'compÃ©tent'],
    'victorieux': ['vaincu', 'dÃ©fait', 'Ã©crasÃ©'],
    'vaincu': ['victorieux', 'vainqueur', 'triomphant'],
    'victoire': ['dÃ©faite', 'Ã©chec', 'revers'],
    'dÃ©faite': ['victoire', 'triomphe', 'succÃ¨s'],
    
    // LibertÃ© et servitude
    'libre': ['esclave', 'captif', 'prisonnier', 'enchaÃ®nÃ©'],
    'esclave': ['libre', 'affranchi', 'libÃ©rÃ©', 'maÃ®tre'],
    'libertÃ©': ['servitude', 'esclavage', 'captivitÃ©', 'asservissement'],
    'servitude': ['libertÃ©', 'affranchissement', 'indÃ©pendance'],
    'libÃ©rer': ['enchaÃ®ner', 'asservir', 'capturer', 'emprisonner'],
    'enchaÃ®ner': ['libÃ©rer', 'affranchir', 'dÃ©livrer', 'dÃ©lier'],
    'dÃ©livrer': ['captif', 'enchaÃ®ner', 'emprisonner'],
    'captif': ['libre', 'dÃ©livrÃ©', 'libÃ©rÃ©', 'affranchi'],
    'autonomie': ['dÃ©pendance', 'subordination', 'asservissement'],
    'dÃ©pendance': ['autonomie', 'indÃ©pendance', 'libertÃ©'],
    'indÃ©pendant': ['dÃ©pendant', 'subordonnÃ©', 'assujetti'],
    'dÃ©pendant': ['indÃ©pendant', 'autonome', 'libre'],
    
    // Premier et dernier
    'premier': ['dernier', 'ultime', 'final', 'terminal'],
    'dernier': ['premier', 'initial', 'originel', 'primordial'],
    'commencer': ['finir', 'terminer', 'achever', 'conclure'],
    'finir': ['commencer', 'dÃ©buter', 'initier', 'inaugurer'],
    'dÃ©but': ['fin', 'terme', 'conclusion', 'achÃ¨vement'],
    'fin': ['dÃ©but', 'commencement', 'origine', 'principe'],
    'origine': ['terme', 'fin', 'aboutissement', 'conclusion'],
    'terme': ['origine', 'principe', 'source', 'commencement'],
    'alpha': ['omÃ©ga', 'fin', 'terme'],
    'omÃ©ga': ['alpha', 'origine', 'principe'],
    'principe': ['fin', 'terme', 'aboutissement', 'conclusion'],
    
    // MaÃ®tre et serviteur
    'maÃ®tre': ['serviteur', 'esclave', 'sujet', 'vassal'],
    'serviteur': ['maÃ®tre', 'seigneur', 'patron', 'chef'],
    'seigneur': ['serviteur', 'vassal', 'sujet', 'serf'],
    'commander': ['obÃ©ir', 'servir', 'se soumettre'],
    'obÃ©ir': ['commander', 'ordonner', 'diriger', 'rÃ©gner'],
    'dominer': ['servir', 'obÃ©ir', 'se soumettre', 'Ãªtre soumis'],
    'servir': ['dominer', 'commander', 'rÃ©gner', 'gouverner'],
    'roi': ['esclave', 'sujet', 'serviteur', 'vassal'],
    'souverain': ['sujet', 'vassal', 'serviteur'],
    
    // IntÃ©rieur et extÃ©rieur
    'dedans': ['dehors', 'extÃ©rieur', 'hors', 'Ã  l\'extÃ©rieur'],
    'dehors': ['dedans', 'intÃ©rieur', 'au-dedans'],
    'intÃ©rieur': ['extÃ©rieur', 'dehors', 'externe', 'superficiel'],
    'extÃ©rieur': ['intÃ©rieur', 'intime', 'profond', 'dedans'],
    'intime': ['lointain', 'distant', 'extÃ©rieur', 'Ã©tranger'],
    'lointain': ['proche', 'intime', 'voisin', 'adjacent'],
    'proche': ['lointain', 'Ã©loignÃ©', 'distant', 'reculÃ©'],
    'Ã©loignÃ©': ['proche', 'voisin', 'adjacent', 'contigu'],
    'proximitÃ©': ['distance', 'Ã©loignement', 'Ã©cart'],
    'distance': ['proximitÃ©', 'voisinage', 'contiguÃ¯tÃ©'],
    
    // UnitÃ© et multiplicitÃ©
    'un': ['multiple', 'divers', 'nombreux', 'pluriel'],
    'multiple': ['un', 'unique', 'seul', 'singulier'],
    'unitÃ©': ['multiplicitÃ©', 'diversitÃ©', 'pluralitÃ©'],
    'multiplicitÃ©': ['unitÃ©', 'unicitÃ©', 'singularitÃ©'],
    'unique': ['multiple', 'divers', 'pluriel', 'nombreux'],
    'divers': ['unique', 'un', 'uniforme', 'identique'],
    'simple': ['composÃ©', 'complexe', 'multiple', 'composite'],
    'composÃ©': ['simple', 'Ã©lÃ©mentaire', 'pur', 'unique'],
    'simplicitÃ©': ['complexitÃ©', 'complication', 'multiplicitÃ©'],
    'complexitÃ©': ['simplicitÃ©', 'simplicitÃ©', 'puretÃ©'],
    'indivisible': ['divisible', 'sÃ©cable', 'sÃ©parable'],
    'divisible': ['indivisible', 'insÃ©cable', 'insÃ©parable'],
    
    // Parole et silence
    'parole': ['silence', 'mutisme', 'taciturnitÃ©'],
    'silence': ['parole', 'verbe', 'discours', 'bruit'],
    'parler': ['taire', 'se taire', 'garder silence'],
    'taire': ['parler', 'dire', 'prononcer', 'exprimer'],
    'dire': ['taire', 'celer', 'cacher', 'dissimuler'],
    'verbe': ['silence', 'mutisme', 'taciturnitÃ©'],
    'exprimer': ['taire', 'cacher', 'dissimuler', 'occulter'],
    'proclamer': ['cacher', 'taire', 'dissimuler', 'voiler'],
    'muet': ['Ã©loquent', 'bavard', 'loquace', 'disert'],
    'Ã©loquent': ['muet', 'silencieux', 'taciturne'],
    
    // ActivitÃ© et passivitÃ©
    'agir': ['subir', 'pÃ¢tir', 'souffrir', 'endurer'],
    'subir': ['agir', 'faire', 'accomplir', 'Å“uvrer'],
    'actif': ['passif', 'inactif', 'inerte', 'oisif'],
    'passif': ['actif', 'agissant', 'actif', 'dynamique'],
    'action': ['passion', 'inaction', 'repos', 'passivitÃ©'],
    'passion': ['action', 'activitÃ©', 'agir'],
    'faire': ['laisser', 'subir', 's\'abstenir', 'ne rien faire'],
    'laisser': ['faire', 'agir', 'intervenir', 'Å“uvrer'],
    'effort': ['abandon', 'relÃ¢chement', 'repos', 'passivitÃ©'],
    'abandon': ['effort', 'rÃ©sistance', 'lutte', 'combat'],
    'volontÃ©': ['abandon', 'rÃ©signation', 'soumission'],
    'travailler': ['reposer', 'se reposer', 'chÃ´mer', 'cesser'],
    'Å“uvre': ['grÃ¢ce', 'don', 'cadeau', 'faveur'],
    'grÃ¢ce': ['Å“uvre', 'mÃ©rite', 'effort', 'travail'],
    'mÃ©rite': ['grÃ¢ce', 'don', 'faveur', 'cadeau'],
    'don': ['mÃ©rite', 'Å“uvre', 'effort', 'rÃ©compense'],
    
    // Mouvement et repos
    'mouvement': ['repos', 'immobilitÃ©', 'stase', 'arrÃªt'],
    'repos': ['mouvement', 'agitation', 'activitÃ©', 'motion'],
    'mobile': ['immobile', 'fixe', 'stationnaire', 'stable'],
    'immobile': ['mobile', 'mouvant', 'agile', 'instable'],
    'marcher': ['demeurer', 'rester', 's\'arrÃªter', 'stationner'],
    'demeurer': ['partir', 'quitter', 'marcher', 'voyager'],
    'aller': ['rester', 'demeurer', 'stationner', 's\'arrÃªter'],
    'rester': ['partir', 'aller', 'quitter', 'se mouvoir'],
    'avancer': ['reculer', 'arrÃªter', 'stopper', 'immobiliser'],
    'arrÃªter': ['avancer', 'progresser', 'continuer', 'poursuivre'],
    'chercher': ['trouver', 'possÃ©der', 'avoir'],
    'trouver': ['chercher', 'perdre', 'Ã©garer'],
    'errer': ['habiter', 'demeurer', 'rÃ©sider', 'sÃ©journer'],
    'habiter': ['errer', 'vagabonder', 'voyager', 'nomadiser'],
    'exil': ['demeure', 'patrie', 'foyer', 'rÃ©sidence'],
    'demeure': ['exil', 'dÃ©part', 'errance', 'nomadisme'],
    'voyage': ['sÃ©jour', 'rÃ©sidence', 'demeure', 'installation'],
    'sÃ©jour': ['voyage', 'dÃ©part', 'exode', 'migration'],
    
    // Temps et Ã©ternitÃ©
    'temps': ['Ã©ternitÃ©', 'intemporel', 'sempiternel'],
    'Ã©ternitÃ©': ['temps', 'temporalitÃ©', 'durÃ©e', 'instant'],
    'temporel': ['Ã©ternel', 'intemporel', 'sempiternel', 'permanent'],
    'Ã©ternel': ['temporel', 'passager', 'Ã©phÃ©mÃ¨re', 'transitoire'],
    'Ã©phÃ©mÃ¨re': ['Ã©ternel', 'permanent', 'durable', 'impÃ©rissable'],
    'permanent': ['Ã©phÃ©mÃ¨re', 'passager', 'transitoire', 'fugace'],
    'passager': ['permanent', 'durable', 'Ã©ternel', 'stable'],
    'transitoire': ['permanent', 'stable', 'durable', 'immuable'],
    'changeant': ['immuable', 'invariable', 'constant', 'stable'],
    'immuable': ['changeant', 'variable', 'instable', 'fluctuant'],
    'corruptible': ['incorruptible', 'impÃ©rissable', 'Ã©ternel'],
    'incorruptible': ['corruptible', 'pÃ©rissable', 'altÃ©rable'],
    
    // Terre et ciel
    'terre': ['ciel', 'paradis', 'empyrÃ©e', 'firmament'],
    'ciel': ['terre', 'monde', 'bas monde', 'ici-bas'],
    'terrestre': ['cÃ©leste', 'Ã©thÃ©rÃ©', 'divin', 'paradisiaque'],
    'cÃ©leste': ['terrestre', 'mondain', 'sÃ©culier', 'temporel'],
    'matÃ©riel': ['spirituel', 'immatÃ©riel', 'incorporel'],
    'spirituel': ['matÃ©riel', 'corporel', 'charnel', 'physique'],
    'corporel': ['spirituel', 'incorporel', 'immatÃ©riel'],
    'chair': ['esprit', 'Ã¢me', 'spirituel'],
    'esprit': ['chair', 'corps', 'matiÃ¨re', 'corporel'],
    'charnel': ['spirituel', 'incorporel', 'immatÃ©riel'],
    'monde': ['ciel', 'paradis', 'royaume', 'Ã©ternitÃ©'],
    'sÃ©culier': ['sacrÃ©', 'religieux', 'spirituel', 'divin'],
    
    // SacrÃ© et profane
    'sacrÃ©': ['profane', 'sÃ©culier', 'laÃ¯c', 'temporel'],
    'profane': ['sacrÃ©', 'saint', 'consacrÃ©', 'bÃ©ni'],
    'saint': ['profane', 'pÃ©cheur', 'impie', 'sacrilÃ¨ge'],
    'divin': ['humain', 'mortel', 'terrestre', 'mondain'],
    'humain': ['divin', 'cÃ©leste', 'transcendant', 'surnaturel'],
    'surnaturel': ['naturel', 'ordinaire', 'commun', 'profane'],
    'naturel': ['surnaturel', 'miraculeux', 'prodigieux', 'divin'],
    'transcendant': ['immanent', 'terrestre', 'mondain'],
    'immanent': ['transcendant', 'au-delÃ ', 'supÃ©rieur'],
    
    // Soi et autre
    'soi': ['autre', 'autrui', 'Ã©tranger', 'prochain'],
    'autre': ['soi', 'mÃªme', 'propre', 'identique'],
    'je': ['tu', 'il', 'autre', 'autrui'],
    'tu': ['je', 'moi', 'soi'],
    'moi': ['toi', 'lui', 'autre', 'autrui'],
    'toi': ['moi', 'je', 'soi'],
    'propre': ['Ã©tranger', 'autre', 'autrui', 'externe'],
    'Ã©tranger': ['familier', 'propre', 'intime', 'proche'],
    'mÃªme': ['autre', 'diffÃ©rent', 'distinct', 'divers'],
    'identitÃ©': ['altÃ©ritÃ©', 'diffÃ©rence', 'distinction'],
    'altÃ©ritÃ©': ['identitÃ©', 'mÃªmetÃ©', 'similitude'],
    
    // VÃ©ritÃ© et erreur
    'vrai': ['faux', 'erronÃ©', 'inexact', 'mensonger'],
    'faux': ['vrai', 'vÃ©ridique', 'exact', 'authentique'],
    'vÃ©ritÃ©': ['erreur', 'mensonge', 'faussetÃ©', 'illusion'],
    'erreur': ['vÃ©ritÃ©', 'exactitude', 'justesse', 'vÃ©racitÃ©'],
    'mensonge': ['vÃ©ritÃ©', 'vÃ©racitÃ©', 'sincÃ©ritÃ©', 'franchise'],
    'authentique': ['faux', 'illusoire', 'trompeur', 'factice'],
    'illusoire': ['rÃ©el', 'authentique', 'vÃ©ritable', 'effectif'],
    'rÃ©el': ['apparent', 'illusoire', 'fictif', 'chimÃ©rique'],
    'apparent': ['rÃ©el', 'vÃ©ritable', 'authentique', 'effectif'],
    'Ãªtre': ['paraÃ®tre', 'sembler', 'apparaÃ®tre'],
    'paraÃ®tre': ['Ãªtre', 'exister rÃ©ellement'],
    
    // Joie et tristesse
    'joie': ['tristesse', 'douleur', 'peine', 'affliction', 'chagrin'],
    'tristesse': ['joie', 'allÃ©gresse', 'gaietÃ©', 'fÃ©licitÃ©'],
    'douleur': ['joie', 'plaisir', 'dÃ©lice', 'fÃ©licitÃ©'],
    'consolation': ['dÃ©solation', 'affliction', 'dÃ©tresse'],
    'dÃ©solation': ['consolation', 'rÃ©confort', 'soulagement'],
    'allÃ©gresse': ['affliction', 'tristesse', 'dÃ©solation', 'peine'],
    'affliction': ['allÃ©gresse', 'joie', 'consolation', 'fÃ©licitÃ©'],
    'bonheur': ['malheur', 'infortune', 'misÃ¨re', 'dÃ©tresse'],
    'malheur': ['bonheur', 'fÃ©licitÃ©', 'bÃ©atitude', 'prospÃ©ritÃ©'],
    'bÃ©atitude': ['souffrance', 'misÃ¨re', 'tourment', 'affliction'],
    'souffrance': ['bÃ©atitude', 'joie', 'dÃ©lice', 'voluptÃ©'],
    
    // Souffrance et gloire
    'souffrance': ['gloire', 'bÃ©atitude', 'joie', 'honneur'],
    'gloire': ['souffrance', 'humiliation', 'opprobre', 'ignominie'],
    'croix': ['gloire', 'triomphe', 'rÃ©surrection', 'couronne'],
    'passion': ['rÃ©surrection', 'gloire', 'triomphe', 'victoire'],
    'rÃ©surrection': ['passion', 'mort', 'crucifixion', 'tombeau'],
    
    // DÃ©sir et dÃ©tachement
    'dÃ©sir': ['dÃ©tachement', 'renoncement', 'abandon', 'indiffÃ©rence'],
    'dÃ©tachement': ['dÃ©sir', 'attachement', 'convoitise', 'aviditÃ©'],
    'vouloir': ['renoncer', 'abandonner', 'lÃ¢cher', 'dÃ©laisser'],
    'renoncer': ['dÃ©sirer', 'vouloir', 'convoiter', 'ambitionner'],
    'convoiter': ['renoncer', 'abandonner', 'dÃ©laisser', 'mÃ©priser'],
    'attacher': ['dÃ©tacher', 'dÃ©lier', 'libÃ©rer', 'affranchir'],
    'dÃ©tacher': ['attacher', 'lier', 'enchaÃ®ner', 'fixer'],
    'tenir': ['lÃ¢cher', 'abandonner', 'relÃ¢cher', 'libÃ©rer'],
    'lÃ¢cher': ['tenir', 'saisir', 'agripper', 'retenir'],
    
    // Parler et taire (apophatisme)
    'affirmer': ['nier', 'dÃ©mentir', 'rÃ©futer', 'contester'],
    'nier': ['affirmer', 'confirmer', 'attester', 'certifier'],
    'indicible': ['exprimable', 'dicible', 'Ã©nonÃ§able'],
    'innommable': ['nommable', 'dÃ©signable', 'dÃ©finissable'],
    'inexprimable': ['exprimable', 'dicible', 'Ã©nonÃ§able'],
    'nommer': ['innommable', 'indicible', 'ineffable'],
    
    // HumilitÃ© et orgueil
    'humble': ['orgueilleux', 'hautain', 'fier', 'arrogant', 'superbe'],
    'orgueilleux': ['humble', 'modeste', 'effacÃ©', 'simple'],
    'humilitÃ©': ['orgueil', 'vanitÃ©', 'fiertÃ©', 'arrogance', 'superbe'],
    'orgueil': ['humilitÃ©', 'modestie', 'simplicitÃ©', 'effacement'],
    'modestie': ['vanitÃ©', 'orgueil', 'suffisance', 'prÃ©tention'],
    'vanitÃ©': ['humilitÃ©', 'modestie', 'simplicitÃ©'],
    
    // Ouverture et fermeture
    'ouvrir': ['fermer', 'clore', 'boucher', 'obstruer'],
    'fermer': ['ouvrir', 'ouvrir', 'dÃ©boucher', 'dÃ©gager'],
    'ouvert': ['fermÃ©', 'clos', 'bouchÃ©', 'obstruÃ©'],
    'fermÃ©': ['ouvert', 'bÃ©ant', 'accessible', 'disponible'],
    'accueillir': ['refuser', 'rejeter', 'repousser', 'Ã©carter'],
    'refuser': ['accueillir', 'accepter', 'recevoir', 'agrÃ©er'],
    'rejeter': ['recevoir', 'accepter', 'accueillir', 'adopter'],
    
    // Sommeil et Ã©veil
    'Ã©veil': ['sommeil', 'assoupissement', 'torpeur', 'lÃ©thargie'],
    'sommeil': ['Ã©veil', 'veille', 'vigilance', 'insomnie'],
    'Ã©veillÃ©': ['endormi', 'assoupi', 'somnolent'],
    'endormi': ['Ã©veillÃ©', 'vigilant', 'alerte', 'lucide'],
    'veille': ['sommeil', 'assoupissement', 'lÃ©thargie'],
    'vigilance': ['torpeur', 'somnolence', 'assoupissement'],
    'torpeur': ['vigilance', 'Ã©veil', 'luciditÃ©', 'vivacitÃ©'],
    'lucide': ['aveugle', 'endormi', 'inconscient', 'confus'],
    
    // Monter et descendre
    'monter': ['descendre', 'tomber', 'choir', 'dÃ©choir'],
    'descendre': ['monter', 'gravir', 'escalader', 's\'Ã©lever'],
    'ascension': ['descente', 'chute', 'dÃ©chÃ©ance', 'abaissement'],
    'descente': ['ascension', 'montÃ©e', 'Ã©lÃ©vation', 'ascension'],
    'Ã©lever': ['abaisser', 'rabaisser', 'humilier', 'avilir'],
    'abaisser': ['Ã©lever', 'hausser', 'exhausser', 'exalter'],
    'grimper': ['tomber', 'chuter', 'dÃ©gringoler', 'choir'],
    'tomber': ['monter', 'grimper', 's\'Ã©lever', 'se dresser'],
    'lever': ['baisser', 'abaisser', 'descendre', 'rabattre'],
    'baisser': ['lever', 'Ã©lever', 'hausser', 'dresser'],
    'chute': ['ascension', 'Ã©lÃ©vation', 'montÃ©e', 'essor'],
    
    // Rassembler et disperser
    'rassembler': ['disperser', 'Ã©parpiller', 'dissÃ©miner', 'rÃ©pandre'],
    'disperser': ['rassembler', 'rÃ©unir', 'grouper', 'concentrer'],
    'unir': ['sÃ©parer', 'diviser', 'dÃ©sunir', 'dissocier'],
    'sÃ©parer': ['unir', 'joindre', 'rÃ©unir', 'rassembler'],
    'joindre': ['sÃ©parer', 'disjoindre', 'diviser', 'Ã©carter'],
    'diviser': ['unir', 'rÃ©unir', 'joindre', 'rassembler'],
    'rÃ©unir': ['sÃ©parer', 'Ã©parpiller', 'disperser', 'dissocier'],
    'Ã©parpiller': ['rassembler', 'rÃ©unir', 'concentrer', 'grouper'],
    'concentrer': ['disperser', 'Ã©parpiller', 'dissÃ©miner'],
    'dissiper': ['concentrer', 'rassembler', 'condenser'],
    
    // Remplir et vider
    'remplir': ['vider', 'Ã©vacuer', 'Ã©puiser', 'tarir'],
    'vider': ['remplir', 'emplir', 'combler', 'garnir'],
    'combler': ['creuser', 'vider', 'Ã©puiser', 'tarir'],
    'creuser': ['combler', 'remplir', 'boucher', 'emplir'],
    'garnir': ['dÃ©pouiller', 'dÃ©garnir', 'vider', 'dÃ©nuder'],
    'dÃ©pouiller': ['garnir', 'revÃªtir', 'habiller', 'parer'],
    'emplir': ['vider', 'Ã©vacuer', 'Ã©puiser', 'tarir'],
    'saturer': ['Ã©puiser', 'vider', 'tarir', 'assÃ©cher'],
    'Ã©puiser': ['remplir', 'combler', 'alimenter', 'fournir'],
    
    // Construire et dÃ©truire
    'construire': ['dÃ©truire', 'dÃ©molir', 'abattre', 'raser'],
    'dÃ©truire': ['construire', 'Ã©difier', 'bÃ¢tir', 'Ã©riger'],
    'Ã©difier': ['dÃ©molir', 'dÃ©truire', 'abattre', 'renverser'],
    'dÃ©molir': ['Ã©difier', 'construire', 'Ã©riger', 'bÃ¢tir'],
    'bÃ¢tir': ['ruiner', 'dÃ©truire', 'dÃ©molir', 'abattre'],
    'ruiner': ['Ã©difier', 'construire', 'bÃ¢tir', 'restaurer'],
    'crÃ©er': ['anÃ©antir', 'dÃ©truire', 'annihiler', 'abolir'],
    'fonder': ['renverser', 'dÃ©truire', 'abolir', 'ruiner'],
    'renverser': ['fonder', 'Ã©tablir', 'Ã©riger', 'Ã©difier'],
    
    // Lier et dÃ©lier
    'lier': ['dÃ©lier', 'dÃ©tacher', 'libÃ©rer', 'dÃ©nouer'],
    'dÃ©lier': ['lier', 'attacher', 'nouer', 'enchaÃ®ner'],
    'attacher': ['dÃ©tacher', 'dÃ©lier', 'libÃ©rer', 'dÃ©gager'],
    'dÃ©tacher': ['attacher', 'lier', 'fixer', 'amarrer'],
    'nouer': ['dÃ©nouer', 'dÃ©lier', 'dÃ©faire', 'dÃ©tacher'],
    'dÃ©nouer': ['nouer', 'lier', 'attacher', 'entrelacer'],
    'retenir': ['relÃ¢cher', 'lÃ¢cher', 'libÃ©rer', 'dÃ©livrer'],
    'relÃ¢cher': ['retenir', 'maintenir', 'garder', 'tenir'],
    
    // Nouveau et ancien
    'nouveau': ['ancien', 'vieux', 'antique', 'archaÃ¯que'],
    'ancien': ['nouveau', 'neuf', 'rÃ©cent', 'moderne'],
    'neuf': ['vieux', 'usÃ©', 'ancien', 'vÃ©tuste'],
    'vieux': ['neuf', 'nouveau', 'jeune', 'rÃ©cent'],
    'recommencer': ['finir', 'terminer', 'achever', 'conclure'],
    'renaissance': ['mort', 'fin', 'dÃ©clin', 'vieillesse'],
    'vieillesse': ['jeunesse', 'renaissance', 'renouveau'],
    'innovation': ['tradition', 'conservation', 'habitude'],
    'tradition': ['innovation', 'renouvellement', 'modernitÃ©']
};

            let antonymes = antonymesMap[keyword] || [];

            for (let [key, values] of Object.entries(antonymesMap)) {
                if (values.includes(keyword)) {
                    antonymes.push(key);
                    antonymes = antonymes.concat(antonymesMap[key] || []);
                }
            }

            return [...new Set(antonymes)];
        }

        async function extractCitationsWithAI(text, keyword = '', numCitations = 5) {
            showMessage('ðŸ¤– Mode IA activÃ© - Analyse du texte...', 'loading');

            // D'abord, obtenir un large panel de candidats (on Ã©largit fortement pour laisser l'IA faire le tri intelligent)
            const candidates = extractCitations(text, keyword, numCitations * 8); // x8 au lieu de x3

            if (candidates.length === 0) {
                return [];
            }

            // PrÃ©parer le texte pour l'IA (limiter la taille globale pour ne pas saturer le contexte)
            // On ne prend que le texte des phrases, sÃ©parÃ©es clairement.
            const candidateTexts = candidates.map(c => c.phrase).join('\n---\n');

            const prompt = `Tu es un expert en spiritualitÃ© chrÃ©tienne et musulmane, spÃ©cialisÃ© dans l'identification des paradoxes mystiques.

DÃ‰FINITION D'UN PARADOXE SPIRITUEL :
Un paradoxe spirituel prÃ©sente une vÃ©ritÃ© qui dÃ©fie la logique ordinaire, oÃ¹ deux rÃ©alitÃ©s apparemment contradictoires coexistent ou se rÃ©vÃ¨lent mutuellement. Ce n'est pas une simple juxtaposition d'antonymes, mais une tension dialectique oÃ¹ l'un rÃ©vÃ¨le l'autre.

EXEMPLES DE VRAIS PARADOXES SPIRITUELS :

Tradition chrÃ©tienne :
- "Mourir pour vivre" (la mort Ã  soi-mÃªme mÃ¨ne Ã  la vraie vie)
- "Qui veut sauver sa vie la perdra, qui la perd la trouve" (Ã‰vangile)
- "ÃŠtre plein en se vidant" (le dÃ©pouillement conduit Ã  la plÃ©nitude divine)
- "Les premiers seront les derniers" (le renversement Ã©vangÃ©lique)
- "Ma puissance se dÃ©ploie dans la faiblesse" (Paul)
- "Pour monter, il faut descendre" (humilitÃ© comme ascension)
- "La nuit obscure illumine" (tÃ©nÃ¨bres mystiques qui Ã©clairent l'Ã¢me)
- "Plus on possÃ¨de Dieu, moins on Le possÃ¨de" (mystique apophatique)
- "ÃŠtre roi en devenant serviteur" (le Christ-Roi servant)
- "Tout avoir en n'ayant rien" (pauvretÃ© Ã©vangÃ©lique)
- "ConnaÃ®tre en ne sachant rien" (docte ignorance)
- "S'anÃ©antir pour Ãªtre" (kÃ©nose)

Tradition musulmane/soufie :
- "Mourir avant de mourir" (fana, l'extinction mystique)
- "PÃ©rir pour subsister" (fana/baqa)
- "ÃŠtre absent pour Ãªtre prÃ©sent" (Ã  Dieu)
- "Se perdre pour se trouver" (dissolution du nafs)
- "L'Ã©loignement est proximitÃ©" (paradoxe de la distance divine)
- "Rien n'existe que Lui, pourtant tout existe" (tawhid)
- "L'ivresse par la sobriÃ©tÃ©" (ivresse spirituelle dans la luciditÃ©)
- "Devenir esclave pour Ãªtre libre" (servitude envers Dieu = libertÃ©)

Paradoxes transversaux :
- "Parler par le silence" (Ã©loquence du silence contemplatif)
- "Agir par l'abandon" (l'action devient grÃ¢ce)
- "PossÃ©der par le renoncement" (dÃ©tachement = vraie possession)
- "Voir en devenant aveugle" (aveuglement physique, vision spirituelle)
- "Comprendre l'incomprÃ©hensible" (mystÃ¨re qui se rÃ©vÃ¨le en restant mystÃ¨re)
- "S'unir en restant distinct" (union mystique sans confusion)
- "Le chemin s'Ã©loigne en s'approchant" (plus on avance, plus le but semble lointain)

CE QUI N'EST PAS UN PARADOXE :
- Simple prÃ©sence d'antonymes : "Il y a de la lumiÃ¨re et des tÃ©nÃ¨bres dans le monde"
- Opposition sans tension rÃ©vÃ©latrice : "Parfois je suis joyeux, parfois triste"
- Contraste descriptif : "Le jour succÃ¨de Ã  la nuit"
- Dualisme banal : "Le bien combat le mal"

Un vrai paradoxe implique que les deux pÃ´les se NÃ‰CESSITENT mutuellement et rÃ©vÃ¨lent une vÃ©ritÃ© plus profonde que leur apparente contradiction.

NE SONT PAS des paradoxes : simple prÃ©sence d'antonymes (lumiÃ¨re/tÃ©nÃ¨bres, joie/tristesse) sans tension dialectique profonde.

PASSAGES Ã€ ANALYSER :
${candidateTexts}

TÃ‚CHE : SÃ©lectionne exactement ${numCitations} citations qui :
1. RelÃ¨vent de la spiritualitÃ© chrÃ©tienne OU musulmane
2. Contiennent un VRAI paradoxe mystique : une affirmation oÃ¹ deux vÃ©ritÃ©s opposÃ©es se rÃ©vÃ¨lent nÃ©cessaires l'une Ã  l'autre, oÃ¹ la contradiction apparente cache une vÃ©ritÃ© plus profonde
3. Sont des phrases complÃ¨tes et comprÃ©hensibles hors contexte
${keyword ? `4. PrivilÃ©gie (sans obligation) les citations contenant "${keyword}" si elles sont paradoxales\n` : ''}

FORMAT DE RÃ‰PONSE :
- Une citation par ligne
- Aucune numÃ©rotation, aucun commentaire, aucune explication
- Phrases exactes extraites du texte
- Si moins de ${numCitations} citations vraiment paradoxales existent, fournis seulement celles qui le sont

RÃ©ponds maintenant avec les citations uniquement :`;

            let attempts = 0;
            currentModelIndex = 0;

            while (attempts < MAX_ATTEMPTS_PER_BOOK && currentModelIndex < OPENROUTER_MODELS.length) {
                const model = OPENROUTER_MODELS[currentModelIndex];

                try {
                    showMessage(`ðŸ¤– IA active - ModÃ¨le: ${model.split('/')[1].split(':')[0]}...`, 'loading');

                    console.log('Envoi au proxy:', {
                        model: model,
                        message_length: prompt.length
                    });

                    const response = await callOpenRouterAPI(prompt, model);

                    if (response && response.trim().length > 0) {
                        // Parser la rÃ©ponse
                        const aiCitations = response
                            .split('\n')
                            .map(line => line.trim())
                            .filter(line => line.length > 30)
                            .slice(0, numCitations);

                        if (aiCitations.length > 0) {
                            showMessage(`âœ… ${aiCitations.length} citation(s) sÃ©lectionnÃ©e(s) par l'IA`, 'info');
                            return aiCitations.map((phrase, index) => ({
                                phrase: phrase,
                                score: 100 - index,
                                position: 0,
                                aiGenerated: true,
                                modelUsed: model.split('/')[1]
                            }));
                        }
                    }

                    // Si pas de rÃ©sultat valide, essayer le modÃ¨le suivant
                    currentModelIndex++;
                    if (currentModelIndex < OPENROUTER_MODELS.length) {
                        await sleep(DELAY_BETWEEN_MODELS);
                    }

                } catch (error) {
                    console.error(`Erreur avec ${model}:`, error);
                    currentModelIndex++;

                    if (currentModelIndex < OPENROUTER_MODELS.length) {
                        await sleep(DELAY_AFTER_ERROR);
                    }
                }

                attempts++;
            }

            // Si tous les modÃ¨les Ã©chouent, retourner les candidats classiques
            showMessage('âš ï¸ IA non disponible - MÃ©thode classique utilisÃ©e', 'info');
            return candidates.slice(0, numCitations);
        }

        async function callOpenRouterAPI(prompt, model) {
            // Construction du payload au format standard OpenRouter (Chat Completions)
            const payload = {
                model: model,
                messages: [
                    {
                        role: "user",
                        content: prompt
                    }
                ],
                temperature: 0.7,
                max_tokens: 2000
            };

            console.log('Payload envoyÃ© au proxy:', payload);

            try {
                const response = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload),
                    signal: AbortSignal.timeout(API_TIMEOUT)
                });

                console.log('Statut rÃ©ponse:', response.status);

                const responseText = await response.text();
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    console.error('RÃ©ponse non JSON reÃ§ue:', responseText);
                    throw new Error(`RÃ©ponse invalide du serveur (${response.status})`);
                }

                if (!response.ok) {
                    console.error('Erreur API reÃ§ue:', data);
                    // Extraction du message d'erreur profond si disponible (format proxy HF)
                    let detailedError = "Erreur inconnue";
                    if (data.details) {
                        try {
                            const details = JSON.parse(data.details);
                            detailedError = details.error?.message || detailedError;
                        } catch (e) {
                            detailedError = data.details;
                        }
                    } else if (data.error) {
                        detailedError = typeof data.error === 'object' ? data.error.message : data.error;
                    }
                    throw new Error(`OpenRouter API error: ${detailedError}`);
                }

                console.log('DonnÃ©es reÃ§ues:', data);

                // Le proxy HuggingFace peut retourner directement le texte ou le format standard
                if (data.response) {
                    return data.response;
                }

                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return data.choices[0].message.content;
                }

                if (data.output && data.output.choices) {
                    return data.output.choices[0].message.content;
                }

                throw new Error('Format de rÃ©ponse AI non reconnu');

            } catch (error) {
                if (error.name === 'TimeoutError') {
                    throw new Error('DÃ©lai d\'attente dÃ©passÃ© (timeout)');
                }
                throw error;
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function displayCitations(citations, useAI = false) {
            citationsContainer.innerHTML = '';
            messageContainer.innerHTML = '';

            if (citations.length === 0) {
                return;
            }

            const keyword = keywordInput.value.trim();
            let message = `${citations.length} citation(s) trouvÃ©e(s)`;
            if (keyword) {
                message += ` avec paradoxe sur "${keyword}"`;
            }
            if (useAI) {
                message += ' (sÃ©lection IA)';
            }
            showMessage(message, 'info');

            citations.forEach((item, index) => {
                const citationDiv = document.createElement('div');
                citationDiv.className = 'citation';
                citationDiv.style.animationDelay = `${index * 0.1}s`;

                let pageNumber = '?';
                if (pageIndex.length > 0 && item.position) {
                    for (let page of pageIndex) {
                        if (item.position >= page.startChar && item.position <= page.endChar) {
                            pageNumber = page.pageNumber;
                            break;
                        }
                    }
                }

                const aiBadge = item.aiGenerated ? `<span class="ai-badge">IA: ${item.modelUsed || 'AI'}</span>` : '';

                citationDiv.innerHTML = `
                    <div class="citation-text">"${item.phrase}"</div>
                    <div class="citation-context">
                        Citation ${index + 1}/${citations.length} ${aiBadge}
                        ${!item.aiGenerated ? `| Score: ${item.score} points` : ''}
                        ${pageIndex.length > 0 && pageNumber !== '?' ? ` | Page ${pageNumber}` : ''}
                    </div>
                `;

                citationsContainer.appendChild(citationDiv);
            });
        }

        function showMessage(text, type) {
            messageContainer.innerHTML = `<div class="${type}">${text}</div>`;
        }
    </script>
</body>

</html>